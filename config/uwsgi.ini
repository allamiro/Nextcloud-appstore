# =============================================================================
# uWSGI Configuration for Nextcloud App Store
# =============================================================================
# Mount this file at /srv/config/uwsgi.ini in the container
# =============================================================================

[uwsgi]
# Application settings
chdir = /srv/appstore
module = nextcloudappstore.wsgi:application
wsgi-file = /srv/appstore/nextcloudappstore/wsgi.py

# Process management
master = true
processes = 4
threads = 2
enable-threads = true

# User/Group
uid = nextcloudappstore
gid = nextcloudappstore

# Socket configuration
# Use 'socket' for uwsgi protocol (recommended with nginx uwsgi_pass)
# Use 'http' for HTTP protocol (if nginx uses proxy_pass)
socket = 0.0.0.0:8000
# http = 0.0.0.0:8000

# Socket permissions (for unix sockets)
# socket = /tmp/uwsgi.sock
# chmod-socket = 666

# Protocol settings
protocol = uwsgi

# Buffer sizes
buffer-size = 65535
post-buffering = 65535

# Timeouts
harakiri = 60
harakiri-verbose = true
http-timeout = 60
socket-timeout = 60

# Memory management
reload-on-rss = 512
max-requests = 5000
max-worker-lifetime = 3600

# Cleanup
vacuum = true
die-on-term = true

# Logging
log-date = true
logto = /srv/logs/uwsgi.log
log-maxsize = 104857600

# Stats (optional - for monitoring)
# stats = 127.0.0.1:9191
# stats-http = true

# Graceful reload
lazy-apps = true
thunder-lock = true

# Python optimizations
optimize = 2
