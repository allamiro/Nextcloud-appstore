# =============================================================================
# Secrets for Nextcloud App Store
# =============================================================================
# IMPORTANT: Replace all placeholder values before applying!
# Generate SECRET_KEY with: 
#   env LC_CTYPE=C tr -dc "a-zA-Z0-9-_\$\?" < /dev/urandom | head -c 64; echo
# Then base64 encode: echo -n "your-value" | base64
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: appstore-secrets
  namespace: nextcloud-appstore
  labels:
    app.kubernetes.io/name: nextcloud-appstore
    app.kubernetes.io/component: secrets
type: Opaque
data:
  # Base64 encoded values - CHANGE THESE!
  # echo -n "your-secret-key-64-chars" | base64
  SECRET_KEY: Q0hBTkdFX1RISVNfSU5fUFJPRFVDVElPTl91c2VfNjRfY2hhcl9yYW5kb21fc3RyaW5n
  
  # echo -n "your-db-password" | base64
  DATABASE_PASSWORD: Y2hhbmdlbWVfcHJvZHVjdGlvbl9wYXNzd29yZA==
  
  # ==========================================================================
  # NOTE: GitHub OAuth is NOT used in air-gapped environments
  # Social login requires internet access which is not available
  # Users must use local accounts created via Django admin
  # ==========================================================================

---
# =============================================================================
# PostgreSQL Secrets
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: postgres-secrets
  namespace: nextcloud-appstore
  labels:
    app.kubernetes.io/name: nextcloud-appstore
    app.kubernetes.io/component: database
type: Opaque
data:
  # echo -n "nextcloudappstore" | base64
  POSTGRES_USER: bmV4dGNsb3VkYXBwc3RvcmU=
  
  # echo -n "nextcloudappstore" | base64
  POSTGRES_DB: bmV4dGNsb3VkYXBwc3RvcmU=
  
  # echo -n "your-db-password" | base64 - CHANGE THIS!
  POSTGRES_PASSWORD: Y2hhbmdlbWVfcHJvZHVjdGlvbl9wYXNzd29yZA==

---
# =============================================================================
# TLS Secret for Ingress/Nginx (Custom CA Chain)
# =============================================================================
# For Tanzu with custom CA, you need:
#   - tls.crt: Server certificate (can include full chain)
#   - tls.key: Private key
#   - ca.crt: CA certificate chain (root + intermediates)
#
# Create with:
#   kubectl create secret generic appstore-tls \
#     --from-file=tls.crt=/path/to/server.crt \
#     --from-file=tls.key=/path/to/server.key \
#     --from-file=ca.crt=/path/to/ca-chain.crt \
#     -n nextcloud-appstore
#
# Or apply this template after base64 encoding your certs:
# =============================================================================
apiVersion: v1
kind: Secret
metadata:
  name: appstore-tls
  namespace: nextcloud-appstore
  labels:
    app.kubernetes.io/name: nextcloud-appstore
    app.kubernetes.io/component: tls
type: Opaque
data:
  # Base64 encoded server certificate (include full chain for best compatibility)
  # cat server.crt intermediate.crt root.crt | base64 -w0
  tls.crt: |
    # REPLACE: base64 encoded certificate chain
    
  # Base64 encoded private key
  # cat server.key | base64 -w0
  tls.key: |
    # REPLACE: base64 encoded private key
    
  # Base64 encoded CA chain (for client verification and trust)
  # cat intermediate.crt root.crt | base64 -w0
  ca.crt: |
    # REPLACE: base64 encoded CA chain

---
# =============================================================================
# TLS Secret in kubernetes.io/tls format (alternative for Ingress)
# =============================================================================
# Use this format if your ingress controller requires it
# =============================================================================
# apiVersion: v1
# kind: Secret
# metadata:
#   name: appstore-tls-ingress
#   namespace: nextcloud-appstore
# type: kubernetes.io/tls
# data:
#   tls.crt: <base64-encoded-certificate-chain>
#   tls.key: <base64-encoded-private-key>
